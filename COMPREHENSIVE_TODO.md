# üéØ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π TODO –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º Code Review

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (P0) - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ!

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–µ–∫—Ä–µ—Ç—ã
- [ ] **–£–î–ê–õ–ò–¢–¨ .secret_key –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è** (—Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç `TdXLojSLcAh3n8rmfJszhEa8a77v7bDSE0ooiwiwI5A`)
  ```bash
  git rm --cached .secret_key
  echo ".secret_key" >> .gitignore
  git commit -m "Remove secret key from repository"
  ```
- [ ] **–ó–∞–º–µ–Ω–∏—Ç—å SHA-256 –Ω–∞ bcrypt/argon2** –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –≤ `api/security.py`
- [ ] **–ó–∞–∫—Ä—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—É—é –≤—ã–¥–∞—á—É JWT —Ç–æ–∫–µ–Ω–æ–≤** - —Ç—Ä–µ–±–æ–≤–∞—Ç—å `X-Admin-Secret` –≤—Å–µ–≥–¥–∞
- [ ] **–ó–∞–º–µ–Ω–∏—Ç—å pickle –Ω–∞ JSON** –≤ Redis –¥–ª—è semantic cache (`tools/semantic_llm_cache.py`)
- [ ] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Ç—å –∫ secret_key** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∏–ª–∏ env –≤–º–µ—Å—Ç–æ `/workspace/.secret_key`

### 2. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –≤ –∫–æ–¥–µ
- [ ] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ `api/security.py`** - –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ `class Role` –≤—ã—à–µ `TokenData` (—Å—Ç—Ä–æ–∫–∏ 111‚Üí54)
- [ ] **–£–¥–∞–ª–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–º–ø–æ—Ä—Ç—ã** –≤ `api/main.py`:
  ```python
  # –£–¥–∞–ª–∏—Ç—å —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ (35-41):
  from tools.multitool import (
      list_instances, get_instance_versions, rollback_instance,  # –ù–ï –°–£–©–ï–°–¢–í–£–Æ–¢!
  )
  ```
- [ ] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏** –≤ voice endpoint (—Å—Ç—Ä–æ–∫–∞ 489):
  ```python
  # –ó–∞–º–µ–Ω–∏—Ç—å:
  chat_response = await send_message(chat_msg)  # –§–£–ù–ö–¶–ò–Ø –ù–ï –û–ü–†–ï–î–ï–õ–ï–ù–ê
  # –ù–∞:
  response_text = await mas_integration.process_message(text, user_id)
  chat_response = ChatResponse(response=response_text, timestamp=time.time())
  ```

### 3. CORS –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å API
- [ ] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—É—é CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**:
  ```python
  # –ó–∞–º–µ–Ω–∏—Ç—å –≤ api/main.py (305-312):
  app.add_middleware(
      CORSMiddleware,
      allow_origins=os.getenv("CORS_ORIGINS", "http://localhost:3000").split(","),
      allow_credentials=False,  # –∏–ª–∏ True —Ç–æ–ª—å–∫–æ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ origins
      allow_methods=["GET", "POST"],
      allow_headers=["Authorization", "Content-Type"],
  )
  ```

## üî• –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (P1) - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏

### 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –¥–æ—Å—Ç—É–ø
- [ ] **–ó–∞—â–∏—Ç–∏—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ endpoints** —Å –ø–æ–º–æ—â—å—é `Depends(require_permission)`:
  - [ ] `/api/v1/registry/*/rollback` - —Ç–æ–ª—å–∫–æ admin
  - [ ] `/api/v1/cache/*` - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - [ ] `/api/v1/federation/*` - —Ç—Ä–µ–±—É–µ—Ç —Ä–æ–ª–∏ admin/agent
  - [ ] `/metrics` - –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç—å—é –∏–ª–∏ —Ä–æ–ª—å—é
  - [ ] WebSocket endpoints - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞

### 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø—É—Ç–∏
- [ ] **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö** - –∑–∞–º–µ–Ω–∏—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ `/workspace/data` –Ω–∞:
  ```python
  DATA_DIR = os.getenv("DATA_PATH", "/app/data")
  ```
  –í —Ñ–∞–π–ª–∞—Ö:
  - `tools/learning_loop.py`
  - `tools/knowledge_graph.py`
  - `tools/federated_learning.py`
  - `tools/quality_metrics.py`

### 6. Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- [ ] **–£–±—Ä–∞—Ç—å reload=True –∏–∑ production** –≤ `api/main.py` (—Å—Ç—Ä–æ–∫–∞ 1261)
- [ ] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Dockerfile CMD** –¥–ª—è production:
  ```dockerfile
  CMD ["uvicorn", "api.main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "2"]
  ```

### 7. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- [ ] **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –≤–æ –≤—Å–µ—Ö API endpoints –∏—Å–ø–æ–ª—å–∑—É—è Pydantic:
  ```python
  class ChatMessage(BaseModel):
      message: str = Field(..., min_length=1, max_length=10000)
      user_id: str = Field(..., regex=r'^[a-zA-Z0-9_-]+$')
  ```

## üìã –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (P2) - –í —Ç–µ—á–µ–Ω–∏–µ 2-3 –Ω–µ–¥–µ–ª—å

### 8. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ ] **–†–∞–∑–±–∏—Ç—å –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π `api/main.py`** (1272 —Å—Ç—Ä–æ–∫–∏) –Ω–∞ —Ä–æ—É—Ç–µ—Ä—ã:
  - [ ] `routers/chat.py`
  - [ ] `routers/auth.py`
  - [ ] `routers/metrics.py`
  - [ ] `routers/registry.py`
  - [ ] `routers/federation.py`
  - [ ] `routers/voice.py`
  - [ ] `routers/websocket.py`

### 9. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] **–ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–¥–æ–≤–µ—Å—Ç–∏ –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–æ 80%)
- [ ] **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** –¥–ª—è:
  - [ ] –ò–º–ø–æ—Ä—Ç–æ–≤ API (–ª–æ–≤–∏—Ç—å ImportError)
  - [ ] Voice endpoints
  - [ ] Security –∏ TokenData
  - [ ] CORS –ø–æ–ª–∏—Ç–∏–∫
  - [ ] WebSocket –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 10. CI/CD Pipeline
- [ ] **–°–æ–∑–¥–∞—Ç—å GitHub Actions workflow** (`.github/workflows/ci.yml`):
  ```yaml
  - Linting (flake8, black)
  - Type checking (mypy)
  - Unit tests (pytest)
  - Coverage report
  - Docker build
  - Security scan (bandit)
  ```

### 11. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤
- [ ] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å knowledge_graph.get_statistics**:
  ```python
  # –ó–∞–º–µ–Ω–∏—Ç—å:
  "relation_types": dict(nx.get_edge_attributes(self.graph, 'type').values())
  # –ù–∞:
  from collections import Counter
  "relation_types": dict(Counter(nx.get_edge_attributes(self.graph, 'type').values()))
  ```
- [ ] **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É X-Forwarded-For** –¥–ª—è rate limiting
- [ ] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Redis URL** –≤ semantic cache - —á–∏—Ç–∞—Ç—å –∏–∑ env

### 12. Docker –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏ Python** (—Å–µ–π—á–∞—Å 3.10 –∏ 3.11 –≤ —Ä–∞–∑–Ω—ã—Ö Dockerfile)
- [ ] **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∏ Docker** - —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –ø–æ—Ç–æ–º –∫–æ–¥
- [ ] **–î–æ–±–∞–≤–∏—Ç—å healthcheck** –≤–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã docker-compose

## üé® –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (P3) - –í —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞

### 13. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] **–î–æ–±–∞–≤–∏—Ç—å connection pooling** –¥–ª—è –ë–î –∏ –≤–Ω–µ—à–Ω–∏—Ö API
- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º** —Å exponential backoff –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] **–î–æ–±–∞–≤–∏—Ç—å Circuit Breaker** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API
- [ ] **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å semantic cache** - –¥–æ–±–∞–≤–∏—Ç—å LRU eviction

### 14. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–µ—Ä–µ–∑ python-json-logger
- [ ] **–î–æ–±–∞–≤–∏—Ç—å correlation ID** –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] **–°–æ–∑–¥–∞—Ç—å Grafana –¥–∞—à–±–æ—Ä–¥—ã** –¥–ª—è Prometheus –º–µ—Ç—Ä–∏–∫
- [ ] **–î–æ–±–∞–≤–∏—Ç—å OpenTelemetry** –¥–ª—è distributed tracing

### 15. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] **–°–æ–∑–¥–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**:
  - [ ] `docs/architecture.md`
  - [ ] `docs/registry.md`
  - [ ] `docs/api_reference.md`
  - [ ] `docs/federation.md`
- [ ] **–î–æ–±–∞–≤–∏—Ç—å OpenAPI —Å—Ö–µ–º—ã** –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
- [ ] **–°–æ–∑–¥–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** (C4 model)

### 16. –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å pre-commit hooks**:
  - [ ] black (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
  - [ ] isort (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤)
  - [ ] flake8 (–ª–∏–Ω—Ç–∏–Ω–≥)
  - [ ] mypy (type checking)
- [ ] **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–ª–∏–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** (> 50 —Å—Ç—Ä–æ–∫)
- [ ] **–î–æ–±–∞–≤–∏—Ç—å type hints** –≤–æ –≤—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ API

### 17. DevOps —É–ª—É—á—à–µ–Ω–∏—è
- [ ] **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ø–ª–æ–π** —á–µ—Ä–µ–∑ CI/CD –≤–º–µ—Å—Ç–æ deploy.sh
- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** –ë–î
- [ ] **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞** –¥–ª—è –ª–æ–≥–æ–≤

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á:
- ‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ > 80%
- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∑–∞–∫—Ä—ã—Ç—ã
- ‚úÖ –í—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞ —Å–∏—Å—Ç–µ–º—ã < 30 —Å–µ–∫—É–Ω–¥
- ‚úÖ API latency p99 < 500ms
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–∫—Ä—ã–≤–∞–µ—Ç 100% –ø—É–±–ª–∏—á–Ω—ã—Ö API
- ‚úÖ CI/CD pipeline –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω

## üîÑ –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ**: P0 –∑–∞–¥–∞—á–∏ (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏)
2. **–ù–µ–¥–µ–ª—è 1**: –ù–∞—á–∞—Ç—å P1 –∑–∞–¥–∞—á–∏ (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
3. **–ù–µ–¥–µ–ª—è 2-3**: –ó–∞–≤–µ—Ä—à–∏—Ç—å P1, –Ω–∞—á–∞—Ç—å P2 (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, —Ç–µ—Å—Ç—ã)
4. **–ú–µ—Å—è—Ü**: P3 –∑–∞–¥–∞—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ç–µ–∫—É—â–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π

---

*–≠—Ç–æ—Ç TODO –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –í–°–ï –∑–∞–º–µ—á–∞–Ω–∏—è –∏–∑ 4 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö code review –æ—Ç—á–µ—Ç–æ–≤*