# 🚀 AutoGen v0.4+ в Root-MAS System

## Что изменилось?

Root-MAS теперь использует **новейшую версию AutoGen v0.4+** с полной обратной совместимостью!

### ✅ Что работает из коробки:
- Все существующие агенты продолжают работать
- API и интеграции остаются без изменений
- Метод `generate_reply()` работает через слой совместимости
- SmartGroupChatManager функционирует как раньше

### 🎯 Новые возможности (доступны опционально):
- **Асинхронная архитектура** - лучшая производительность
- **Потоковая обработка** - real-time ответы агентов
- **Прямая работа с инструментами** - без UserProxy
- **Teams API** - продвинутые паттерны взаимодействия
- **Улучшенная наблюдаемость** - детальный контроль выполнения

## Установка с автоматической проверкой

### Вариант 1: Полная автоматическая установка (Linux/Mac)
```bash
./setup.sh    # Установит Python, создаст venv, установит все зависимости
./start.sh    # Запустит систему с проверками
```

### Вариант 2: Python установщик (все платформы)
```bash
python install_and_run.py
```

Этот скрипт автоматически:
- ✅ Проверит версию Python (нужен 3.9-3.13)
- ✅ Удалит старый pyautogen если есть
- ✅ Установит новые пакеты AutoGen v0.4+
- ✅ Проверит все импорты
- ✅ Создаст шаблон .env
- ✅ Запустит систему

## Структура пакетов AutoGen v0.4

```
autogen-agentchat >= 0.5.1   # Основной пакет для агентов
autogen-ext[openai] >= 0.5.5  # Расширения и модели
autogen-core                  # Базовый фреймворк (зависимость)
```

## Примеры использования новых API

### 1. Базовый агент (с обратной совместимостью)
```python
from agents.base import BaseAgent

# Работает как раньше!
agent = BaseAgent("my_agent", model="gpt-4o-mini", tier="cheap")
response = agent.generate_reply([{"content": "Привет!"}])
```

### 2. Новый асинхронный подход (опционально)
```python
# Для лучшей производительности
response = await agent.generate_reply_async([{"content": "Привет!"}])
```

### 3. Полный пример с новыми возможностями
Смотрите `examples/autogen_v04_example.py` для примеров:
- Потоковая обработка
- Teams API
- Прямая работа с инструментами

## Решение проблем

### Если агенты не отвечают:
1. Проверьте OPENROUTER_API_KEY в .env
2. Запустите `python test_autogen_v04.py` для диагностики
3. Система автоматически использует fallback режим

### Если ошибки импорта:
```bash
pip uninstall -y pyautogen  # Удалить старую версию
pip install autogen-agentchat>=0.5.1 autogen-ext[openai]>=0.5.5
```

### Если проблемы с Python версией:
- AutoGen v0.4 требует Python >= 3.9, < 3.14
- Используйте `./setup.sh` для автоматической установки правильной версии

## Миграция на полностью новый API (в будущем)

Сейчас система работает через слой совместимости. Для постепенной миграции:

1. **Фаза 1** (сейчас): Все работает через совместимость
2. **Фаза 2**: Переход на асинхронные вызовы где возможно
3. **Фаза 3**: Использование Teams API для групповых чатов
4. **Фаза 4**: Полный переход на новую архитектуру

## Полезные ссылки

- [Официальная документация AutoGen v0.4](https://microsoft.github.io/autogen/dev/)
- [Руководство по миграции](https://microsoft.github.io/autogen/dev/user-guide/agentchat-user-guide/migration-guide.html)
- [Примеры кода](https://github.com/microsoft/autogen/tree/main/examples)

## Поддержка

Если возникли проблемы:
1. Проверьте `MIGRATION_GUIDE.md` для деталей миграции
2. Запустите тесты: `python test_autogen_v04.py`
3. Проверьте логи на наличие ошибок AutoGen

---

**🎉 Система готова к работе с новейшей версией AutoGen!**